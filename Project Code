from nicegui import ui

# Video library
videos = {
    'Big Buck Bunny': 'https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/360/Big_Buck_Bunny_360_10s_1MB.mp4',
    'Elephants Dream': 'http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4',
    'For Bigger Blazes': 'http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4',
    'For Bigger Escape': 'http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerEscapes.mp4',
    'Sintel': 'http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/Sintel.mp4'
}

# Function to display videos that match the query
def show_matching_videos(query: str):
    video_gallery.clear()
    query = query.lower()
    matches = [title for title in videos if query in title.lower()]
    
    if matches:
        for title in matches:
            with video_gallery:
                with ui.card().tight():
                    ui.video(videos[title]).style('width: 300px; height: auto')
                    ui.label(title)
        video_gallery.visible = True
    else:
        video_gallery.visible = False

# Callback for search input
def handle_input(_):
    show_matching_videos(search_input.value.strip())

# Callback for Home button
def go_home():
    search_input.value = ''
    show_matching_videos('')

# Top bar with Home button and search box
with ui.row().style('gap: 20px; margin-bottom: 20px;'):
    ui.button('Home', on_click=go_home).style('height: 40px')
    search_input = ui.input(
        label='Search Videos',
        placeholder='Type part of a title and press Enter',
    ).props('autocomplete')

search_input.on('keydown.enter', handle_input)
search_input.on('blur', handle_input)

# Gallery container
video_gallery = ui.row().style('flex-wrap: wrap; gap: 20px; margin-top: 20px;')

# Initial full gallery
show_matching_videos('')

ui.run(port=555)
